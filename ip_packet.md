מבנה פקטת IP  

מאחר וגודל פקטות המידע שנשלחות הוא אינו קבוע ויכול להיות משליחת הודעה קטנה לבדיקת ping לבין הודעה עם דף אינטרנט שלם, ישנו גבול לגודל ההודעה, גבול לכמות הנתונים שניתן להעביר באופן סביר בבת אחת על ידי חיבורי הרשת הפיזיים בין מכשירים.

פרוטוקולי רשת רבים מפרקים מפצלים כל הודעה לפקטות קטנות שיעמדו בגבול זה. פקטות אלו נקראות פקטות IP.

כל פקטה מורכבת מ-Header (בגודל 20/24 בתים) ומנתונים (באורך משתנה).
![image](https://github.com/user-attachments/assets/07282311-fbb9-449e-901c-634eef39bc7b)



ה-Header בנויה מכתובת הIP של היעד ושל המקור ומשדות נוספים הנחוצים לניתוב הפקטה. גודלו 24 בתים והוא מכיל 15 שדות, כולל 4 בתים עבור כתובת ה-IP של המקור ו-4 בתים עבור כתובת ה-IP של היעד.

הנתונים בנויים מהתוכן של הפקטה עצמה (בין אם מחרוזות של הפקטה עצמה לחלק מדך אינטרנט).

לצורך השווה להבנה קלה יותר: פקטת IP היא כמו מעטפת דואר, ה-Header הוא המעטפה עם כל מידע הניתוב הדרוש לסניף הדואר והנתונים הם כמו המכתב עצמו שנקרא רק על ידי הנמען.

 ![image](https://github.com/user-attachments/assets/aed36e08-5d63-4612-8668-b3921cd8cde7)

מוצגת מעטפה עם "כתובת IP מקור" ככתובת ההחזרה ו"כתובת IP של יעד" ככתובת הדואר. לאחר מכן המעטפה מוצגת במצב פתוח, עם דף שמבצבץ החוצה ושכתוב עליו "נתונים".

בדיוק כמו שמערכת הדואר מנתבת מכתבי דואר ברחבי העולם, פרוטוקול האינטרנט מנתבים מנות IP ברחבי האינטרנט.

<br>

מה זה IP Fragmentation?  

פיצול IP הוא תהליך של פירוק פקטות לחלקים קטנים יותר הנקראים פרגמנטים. כאשר הפקטה מפוצלת הפרגמנטים מועברים על פני הרשת ומורכבים מחדש ביעדם על מנת לשחזר את החבילה המקורית.

תהליך פיצול ה-IP מתרחש בדרך כלל ב-router או ב-switch אך עשוי להתרחש גם בכרטיס רשת (אם הכרטיס הוגדר לבצע פיצול). 

במהלך תהליך הפיצול, הפקטה המקורית מחולקת למספר רב של קטעים שכל אחד מהם מכיל עותק של header עם ה-IP Datagram המקורית (עם שינויים קלים בכמה שדות header). שינויים אלה מזהים את הפרגמנט כחלק מהחבילה המקורית ומאפשרים הרכבה מחדש כאשר הפרגמנטים מגיעים ליעדם.

![image](https://github.com/user-attachments/assets/2b72e541-1270-41fd-91f1-dc4d50a89767)

תוקף יכול לנצל תהליך זה במספר דרכים:

בדרך אחת התוקף שולח המון פרגמנטים קטנים ליעד שה- offset של אף אחד מהם לא שווה לאפס על מנת לנסות להיכנס לאמצע שיחה ולא להתחיל הודעה חדשה. ביעד עלול לקרוס בזמן שהוא מנסה להרכיב בחזרה את הפקטה מהפרגמנטים השונים.

דרך נוספת לניצול תהליך זה כוללת שליחת פרגמנטים זהים עם offset שונה, דבר הגורם למערכת ההפעלה לקרוס ולא לדעת מה לעשות עם כל הפרגמנטים שקיבל.


<br>

חלוקת כתובת IP  

לצורך חלוקת כתובות IP ישנו פרוטוקול הנקרא DHCP (dynemic host configuration ptrotocol). זהו פרוטוקול המקצה באופן דינאמי כתובות IP למחשבים ברשת מקומית (LAN). 

לשרת ה-DHCP מוגדר תחום כתובות (pool) ממנו הוא מקצה למחשבים כתובות IP. בנוסף לכתובות IP השרת מקצה גם כתובות שרתי DNS וכתובות default gateway.

ישנם 4 שלבים בחלוקת הכתובות:

1. השלב הראשון- DHCP discovery

הלקוח שולח חבילת DHCP discovery בהודעת broadcast לכלל המחשבים ברשת ה-LAN על מנת לאתר שרת DHCP.

2. השלב השני- DHCP offer

אם קיימים שרתי DHCP בארגון, כל אחד מהם ישלח ב-Unicast חבילת DHCP offer ללקוח עם כתובת IP (כתובת זו תקפה לשעה לצורך אימות).

3. השלב השלישי- DHCP request

הלקוח שולח הודעת broadcast עם ההגדרות שבחר.

4. השלב הרביעי- DHCP acknowledge

השרת מגיב ללקוח ה-unicast על אישור הבקשה.

![image](https://github.com/user-attachments/assets/8389af7b-71cd-484c-9c92-4700699ba23a)
