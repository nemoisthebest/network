# פרוטוקול ARP

פרוטוקול Address Resolution Protocol) ARP) הוא פרוטוקול המחבר כתובת IP (כתובת לא קבועה המשתנה מידי פעם), לכתובת פיזית קבועה, הידועה גם בשם MAC, ברשת מקומית (LAN).

הליך מיפוי זה חשוב מכיוון שאורכם של כתובות ה-IP וה -MAC שונים, ויש צורך בהליך תרגום זה כדי שהמערכות יוכלו לזהות זו את זו. ה-IP הנפוץ ביותר כיום הוא IP גרסה 4 (IPv4). כתובת IP היא באורך 32 סיביות. עם זאת, כתובות MAC הן באורך 48 סיביות. ARP מתרגם את כתובת ה-32 סיביות ל-48 ולהיפך.

כתובת ה-MAC ידועה גם כשכבת קישור הנתונים (שכבה בין הפיזית לערוץ הנתונים, לא שכבה שרשמית במודל ה-OSI), אשר מייצרת ומפסיקה חיבור בין שני התקנים המחוברים פיזית כך שהעברת נתונים יכולה להתבצע. כתובת ה-IP מכונה גם שכבת הרשת או השכבה האחראית להעברת מנות נתונים דרך נתבים שונים. ARP עובד בין השכבות הללו.

### מה עושה ARP ואיך הוא עובד?

כאשר מחשב חדש מצטרף לרשת מקומית (LAN), הוא יקבל כתובת IP ייחודית לשימוש לצורך זיהוי ותקשורת.

פקטות עם נתונים מגיעות לשעת יציאה (gateway), המיועד למחשב host מסוים. השער, או חלק בחומרת הרשת המאפשר זרימת נתונים מרשת אחת לאחרת, מבקש מ-ARP למצוא כתובת MAC התואמת לכתובת ה-IP. זיכרון מטמון ה-ARP שומר רשימה של כל כתובת IP וכתובת ה-MAC התואמת שלה. מטמון ה-ARP הוא דינמי, אך משתמשים ברשת יכולים גם להגדיר טבלת ARP סטטית המכילה כתובות IP וכתובות MAC.

מטמוני ARP נשמרים בכל מערכות ההפעלה ברשת IPv4 Ethernet. בכל פעם שהתקן מבקש כתובת MAC כדי לשלוח נתונים להתקן אחר המחובר ל-LAN, המכשיר מאמת את מטמון ה-ARP שלו כדי לראות אם החיבור של כתובת ה-IP ל-MAC כבר הושלם. אם היא קיימת, אז בקשה חדשה מיותרת. עם זאת, אם התרגום עדיין לא בוצע, אז הבקשה לכתובות רשת נשלחת, ו-ARP מבוצע.

גודל מטמון ARP מוגבל וכתובות נוטות להישאר במטמון למספר דקות בלבד. הוא מנוקה באופן קבוע כדי לפנות מקום. ניקוי זה נועד גם לפרטיות ואבטחה כדי למנוע גניבה או זיוף של כתובות IP על ידי תוקפי סייבר. בעוד שכתובות MAC קבועות, כתובות IP מתעדכנות כל הזמן.

בתהליך הניקוי, כתובות לא מנוצלות נמחקות, כך גם כל נתונים הקשורים לניסיונות לא מוצלחים לתקשר עם מחשבים שאינם מחוברים לרשת או אפילו לא מופעלים.

![image](https://github.com/user-attachments/assets/e7f0d39f-144c-4256-bee5-046a6fd9fcc2)

## מה זה Arp Gratuitous?

סוג זה של ARP נקרא בתרגום חופשי ARP ללא סיבה. במקרה זה ה-ARP הוא תגובת ARP שלא התקבלה על ידי בקשת ARP. ה-ARP נשלח כ-broadcast לכל הרשת, על מנת להכריז על שינוי או עדכון של ה-IP שלו בהתאם ל-MAC.

ישנם שלושה מקרים עיקריים בהם נשתמש ב-ARP Gratuitous: עדכון התאמות ARP, הכרזה על קיומו של קשר ועודף כתובות.

![gratuitous-arp-shared-ip](https://github.com/user-attachments/assets/c94a8c52-668e-4d28-aaaa-fb3097b04563)

ראוטר A וראוטר B חולקים את כתובת ה-(10.0.0.1)IP ואת כתובת ה-(MAC  (0053.ffff.1111. ה-HOST'S מוגדרים עם שער יציאה ברירת מחדל של 10.0.0.1, ולכל אחד מהם יש שורת ARP המציינת את כתובת ה-IP 10.0.0.1 המותאמת לכתובת MAC 0053.ffff.1111 בטבלת ה-ARP. מכיוון שגם כתובת ה-MAC וגם כתובת ה-IP משותפות בין שני הנתבים, התאמת ARP זו לעולם לא תצטרך להתעדכן.

עם זאת, כאשר ראוטר A הוא נתב ההפעיל, כתובת ה-MAC מוגשת על ידי ההתקן המחובר ל-switchport 1. אם ראוטר A נכשל, אז ראוטר B שולח ARP Gratuitous כדי לעדכן את טבלת כתובות ה-MAC של ה-switch שכתובת ה-MAC (0053.ffff.1111) משרתת כעת את המכשיר המחובר ל-switchport 2.

התהליך מתרחש שוב אם ראוטר B נכשל, ו-ראוטר A צריך להשתלט בחזרה על שירות ה-IP/MAC (10.0.0.1/0053.ffff.1111).
